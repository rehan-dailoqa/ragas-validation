from datasets import Dataset
from ragas.metrics import (
    faithfulness,
    answer_relevancy,
    context_precision,
    context_recall,
    answer_correctness, #LLM Based
)
from ragas import evaluate

# Example dataset from your RAG system
data = {
    "question": [
        "What is the leverage ratio for Coventry building society?",
        "Tell me about the net interest margin of coventry in 2024",
    ],
    "ground_truth": [
        "5.7%",
        "The net interest margin of coventry in 2024 was reported as 1.07%",
    ],
    "answer": [
        "### Summary\nThe UK leverage ratio for Coventry Building Society in 2024 was reported as 5.7%, an increase from 5.4% in 2023. However, the Graph QA method returned an empty set, indicating no available data for this metric.\n\n### Key Financial Metrics\n- **UK Leverage Ratio (2024)**: 5.7% (Vector Search, Keyword Search)\n- **UK Leverage Ratio (2023)**: 5.4% (Vector Search, Keyword Search)\n- **Common Equity Tier 1 (CET1) Ratio (2024)**: 28.0% (down from 29.1% in 2023)\n- **Net Interest Margin (2024)**: 1.07% (down from 1.26% in 2023)\n\n### Limitations\nThe Graph QA method did not provide any data regarding the UK leverage ratio for Coventry Building Society in 2024, indicating a limitation in the dataset or query results.\n\n### Perspectives from Different Methods\n- **Graph QA**: Returned an empty set for the UK leverage ratio, indicating no available data.\n- **Vector Search**: Provided the UK leverage ratio as 5.7% for 2024, along with additional financial metrics.\n- **Keyword Search**: Also reported the UK leverage ratio as 5.7% for 2024, consistent with the Vector Search results.",
        "### Summary The net interest margin for Coventry Building Society in 2024 was reported as **1.07%**. This represents a decrease from the previous year's net interest margin of **1.26%**. ### Key Metrics - **Net Interest Margin**: - 2024: **1.07%** (Vector Search and Keyword Search) - 2023: **1.26%** - **Profit Before Tax**: - 2024: **£323 million** (down from **£474 million** in 2023) - Excluding acquisition and integration costs: **£349 million** - **Cost to Income Ratio**: - 2024: **54.0%** (increase from **39.4%** in 2023) - **Liquidity Coverage Ratio**: - 2024: **207%** (decrease from **227%** in 2023) - **Mortgages in Arrears**: - 2024: **0.33%** (increase from **0.26%** in 2023) - **Cost as a Percentage of Average Assets**: - 2024: **0.57%** (compared to **0.51%** in 2023) ### Limitations - The Graph QA Answer indicated that no data was available for the net interest margin for Coventry Building Society in 2024, resulting in an empty set. This contrasts with the values provided by the Vector Search and Keyword Search methods, which both reported the net interest margin as **1.07%**. - The discrepancy between the Graph QA Answer and the other methods highlights a limitation in the data availability or extraction process for the knowledge graph. Overall, while the net interest margin is clearly stated by two methods, the lack of data from the Graph QA Answer suggests potential gaps in the knowledge graph's coverage for this financial metric.",
    ],
    "contexts": [
        ["STRATEGIC REPORT: Coventry Building Society | Annual Report & Accounts 2024 5 Strategic Report Capital ratios Sustainable financial performance 28.0% Common Equity Tier 1 (2023: 29.1%) 5.7% UK leverage ratio (2023: 5.4%) 1.07% Net interest margin (2023: 1.26%) 54.0% Cost to income ratio (2023: 39.4%) 207% Liquidity Coverage Ratio (2023: 227%) Low risk Profitability £323m Reported profit before tax (2023: £474m) £349m excluding acquisition & integration costs 0.57% Cost as a percentage of average assets (2023: 0.51%) 0.33% of mortgages more than 3 months in arrears (2023: 0.26%) Efficiency 1. Based on the Society’s average month end savings rate compared to the CACI Ltd's Current Account and Savings Database rest of market average rate for savings accounts, excluding current accounts and offset savings, for the 12 months of the year. 2. A measure of customer advocacy that ranges between -100 and +100 representing how likely a customer is to recommend our products and services. 3. Based on average call waiting times between 1 January 2024 and 31 December 2024. 4. Total community investment made by the Society has been determined in line with the Business for Societal Impact (B4SI) framework. 5. A measure indicating a trust-based people first workplace based on positive responses to the annual Great Place to Work survey. Performance highlights continued","of their first home. Our priority is always to balance the interests of our savers and borrowers, while maintaining the Society's financial strength for the good of all members, current and future. The ability to plan for the long-term success of the Society has been at the heart of our transformational acquisition of The Co-operative Bank. Members' interests were central to this acquisition, which we completed on 1 January 2025. As we celebrate our 140th anniversary, we believe that this groundbreaking combination of ethical and purpose- led organisations is an opportunity to build, and future- proof, a bigger and better mutual building society for the benefit of all stakeholders. Steve, our Chief Executive, will talk more in his review about the rationale and implications of the acquisition and the integration plans that lie ahead. However, in listening to our members, it is clear that while they see the potential benefits of the acquisition, their immediate priority is that we maintain the strength of the Society's existing proposition, and particularly the outstanding service, value and security that they receive today. The Board and the Society's executive team are committed to meeting this expectation, and we believe that the Society's performance this year shows that this focus has been unaffected by the additional work required to make the acquisition a reality. Coventry Building Society | Annual Report & Accounts 2024 6 A statement from our Chair Strategic Report","the Bank of England's target range, and that base rate could be cut as many as five times during the course of the year. Instead, continued geopolitical uncertainty, including elections in the UK and US, together with persistent inflation in the service sector and wages generally, meant that base rate was cut just twice, ending the year at 4.75%. The UK economy performed sluggishly during the year, and whilst it is understandable that the new government has placed economic growth at the heart of its objectives, this will not be easily achieved. The housing market was forecast to be relatively static in 2024 and this was borne out as the slower than anticipated reduction in interest rates dampened demand. The interest rate environment has also prolonged the concern felt by many borrowers who are yet to remortgage from the extremely low rates of the last few years. In this context, the Board have been reassured by the Society's arrears position, which shows that the combination of our responsible lending and focused customer care, together with tighter regulation, is keeping members in their homes and repayments on track. Savers, of course, have benefitted as rates remained higher than forecast. Our aim is to encourage the saving habit, with all the attendant benefits of increased personal financial resilience. We continued to recognise our savers' loyalty and introduced additional incentives to help people save, including linking savings to the purchase of their first home. Our priority is always to balance the interests of our savers and borrowers, while maintaining the Society's financial strength for the good of all members, current and future. The ability to plan for the long-term success of the Society has been at the heart of our transformational acquisition of The Co-operative Bank. Members' interests were central to this acquisition, which we completed on 1 January 2025.","the needs of all of our customers and members, and ensuring the financial strength and stability of the combined Group. I believe the acquisition paves the way for an exciting future, one that builds on the shared mutual and co- operative values of our heritage to create a sustainable and differentiated type of financial services organisation, with members and customers at the heart of our decision- making. David Thorburn Chair of the Board 6 March 2025 Coventry Building Society | Annual Report & Accounts 2024 7 The Society is focused on consistently meeting the needs of its members and customers. A statement from our Chair continued Strategic Report"],
        ["STRATEGIC REPORT: Coventry Building Society | Annual Report & Accounts 2024 5 Strategic Report Capital ratios Sustainable financial performance 28.0% Common Equity Tier 1 (2023: 29.1%) 5.7% UK leverage ratio (2023: 5.4%) 1.07% Net interest margin (2023: 1.26%) 54.0% Cost to income ratio (2023: 39.4%) 207% Liquidity Coverage Ratio (2023: 227%) Low risk Profitability £323m Reported profit before tax (2023: £474m) £349m excluding acquisition & integration costs 0.57% Cost as a percentage of average assets (2023: 0.51%) 0.33% of mortgages more than 3 months in arrears (2023: 0.26%) Efficiency 1. Based on the Society’s average month end savings rate compared to the CACI Ltd's Current Account and Savings Database rest of market average rate for savings accounts, excluding current accounts and offset savings, for the 12 months of the year. 2. A measure of customer advocacy that ranges between -100 and +100 representing how likely a customer is to recommend our products and services. 3. Based on average call waiting times between 1 January 2024 and 31 December 2024. 4. Total community investment made by the Society has been determined in line with the Business for Societal Impact (B4SI) framework. 5. A measure indicating a trust-based people first workplace based on positive responses to the annual Great Place to Work survey. Performance highlights continued","the Bank of England's target range, and that base rate could be cut as many as five times during the course of the year. Instead, continued geopolitical uncertainty, including elections in the UK and US, together with persistent inflation in the service sector and wages generally, meant that base rate was cut just twice, ending the year at 4.75%. The UK economy performed sluggishly during the year, and whilst it is understandable that the new government has placed economic growth at the heart of its objectives, this will not be easily achieved. The housing market was forecast to be relatively static in 2024 and this was borne out as the slower than anticipated reduction in interest rates dampened demand. The interest rate environment has also prolonged the concern felt by many borrowers who are yet to remortgage from the extremely low rates of the last few years. In this context, the Board have been reassured by the Society's arrears position, which shows that the combination of our responsible lending and focused customer care, together with tighter regulation, is keeping members in their homes and repayments on track. Savers, of course, have benefitted as rates remained higher than forecast. Our aim is to encourage the saving habit, with all the attendant benefits of increased personal financial resilience. We continued to recognise our savers' loyalty and introduced additional incentives to help people save, including linking savings to the purchase of their first home. Our priority is always to balance the interests of our savers and borrowers, while maintaining the Society's financial strength for the good of all members, current and future. The ability to plan for the long-term success of the Society has been at the heart of our transformational acquisition of The Co-operative Bank. Members' interests were central to this acquisition, which we completed on 1 January 2025.","of their first home. Our priority is always to balance the interests of our savers and borrowers, while maintaining the Society's financial strength for the good of all members, current and future. The ability to plan for the long-term success of the Society has been at the heart of our transformational acquisition of The Co-operative Bank. Members' interests were central to this acquisition, which we completed on 1 January 2025. As we celebrate our 140th anniversary, we believe that this groundbreaking combination of ethical and purpose- led organisations is an opportunity to build, and future- proof, a bigger and better mutual building society for the benefit of all stakeholders. Steve, our Chief Executive, will talk more in his review about the rationale and implications of the acquisition and the integration plans that lie ahead. However, in listening to our members, it is clear that while they see the potential benefits of the acquisition, their immediate priority is that we maintain the strength of the Society's existing proposition, and particularly the outstanding service, value and security that they receive today. The Board and the Society's executive team are committed to meeting this expectation, and we believe that the Society's performance this year shows that this focus has been unaffected by the additional work required to make the acquisition a reality. Coventry Building Society | Annual Report & Accounts 2024 6 A statement from our Chair Strategic Report","In July, we also welcomed Ewa Kerin, an experienced financial services executive, to the Board as a non- executive director. Very sadly, Ewa had to resign in November for family reasons, and we offer both Ewa and Vanessa our very best wishes for the future. In January 2025, Caroline Marsh joined our Board as a non- executive director. Caroline is a former financial services executive with extensive experience in UK retail banking and brings both product and operational expertise as well as Board experience. She will be chairing the Society's Remuneration Committee and will fulfil the same role at the Bank from April 2025. Mark Parker, an existing member of the Bank Board, also joined the Group Board with effect from January 2025. The acquisition of The Co-operative Bank has meant an extensive review of governance structures and arrangements. This is summarised on page 12 of this Annual Report. Board priorities for the year ahead In the coming year, we are anticipating further easing in the interest rate environment and believe this will support an increase in housing market activity. We will continue to work hard to balance the needs of our mortgage and savings members, and ensure we meet their expectations in terms of service and value. Having completed the acquisition of The Co-operative Bank in January 2025, we have begun the work to integrate the two organisations and deliver the benefits I have outlined. This work will take some years to complete, and our priorities in this time will be to meet the needs of all of our customers and members, and ensuring the financial strength and stability of the combined Group. I believe the acquisition paves the way for an exciting future, one that builds on the shared mutual and co- operative values of our heritage to create a sustainable and differentiated type of financial services organisation, with members and customers at the heart of our decision- making. David Thorburn Chair of the Board"],
    ],
}

# Convert to HuggingFace dataset format
dataset = Dataset.from_dict(data)

# Run evaluation
result = evaluate(
    dataset,
    metrics=[
        faithfulness,
        answer_relevancy,
        context_precision,
        context_recall,
        answer_correctness, #LLM Based
    ]
)

# Print results
print("RAG Evaluation Results:")
print(result)
